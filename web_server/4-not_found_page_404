#!/usr/bin/env bash
# This script configures Nginx to serve a custom 404 error page with the message "Ceci n'est pas une page".

# Step 1: Update the package list and install Nginx if not already installed
apt-get update
apt-get install -y nginx

# Step 2: Create the custom 404 error page with the required message
echo "Ceci n'est pas une page" | sudo tee /etc/nginx/html/404.html

# Step 3: Backup the existing Nginx configuration file (default server block)
sudo cp /etc/nginx/sites-available/default /etc/nginx/sites-available/default.bak

# Step 4: Modify the Nginx configuration to set up the custom 404 page
sudo sed -i '/server_name _;/a \
	    error_page 404 /404.html;\
	        location = /404.html {\
		        root /etc/nginx/html;\
			    }' /etc/nginx/sites-available/default

			    # Step 5: Test the Nginx configuration for any syntax errors
			    nginx -t

			    # Step 6: If the test is successful, restart Nginx to apply changes
			    if [ $? -eq 0 ]; then
				        sudo systemctl restart nginx
				else
					    echo "Nginx configuration test failed. Please check the config."
			    fi

			    # Step 7: Verify by trying to access a non-existent page (e.g., /xyz)
			    curl -sI http://localhost/xyz

